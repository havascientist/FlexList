<?php
include 'koneksi.php';
if (isset($_SESSION['user'])) {
    $check_akun = mysqli_query($koneksi, "SELECT * FROM akun WHERE username = '".$_SESSION['user']['username']."'");
    $data_akun = mysqli_fetch_assoc($check_akun);
    $sess_username = $_SESSION['user']['username'];
} else {
    header("Location : ".$url."login");
}
if (isset($_POST['submit'])) {
    $tanggal = $_POST['tanggal'];
    $jadwal = $_POST['jadwal'];
    $query = "INSERT INTO jadwal (username, tanggal, jadwal) VALUES ('$sess_username', '$tanggal', '$jadwal')";
    mysqli_query($koneksi, $query);
}

$query = "SELECT tanggal, jadwal FROM jadwal WHERE username = '$sess_username'";
$result = mysqli_query($koneksi, $query);
$data_jadwal = array();
while ($row = mysqli_fetch_assoc($result)) {
    $data_jadwal[$row['tanggal']] = $row['jadwal'];
}
$bulan = date('m');
$tahun = date('Y');
$jumlah_hari = date('t', mktime(0, 0, 0, $bulan, 1, $tahun));
$hari_pertama = date('N', mktime(0, 0, 0, $bulan, 1, $tahun));
?>
<html>
<head>
	<title>Kalender</title>
	<style>
		table {
			border-collapse: collapse;
		}
		td {
			border: 1px solid black;
			padding: 5px;
			width: 100px;
			height: 100px;
			vertical-align: top;
		}
		td:hover {
			background-color: #cccccc;
		}
	</style>
</head>
<body>
	<h1>Kalender</h1>
	<p>Tanggal: <?php echo date('d F Y'); ?></p>
	<?php
		echo "<table>";
		echo "<tr>";
		echo "<th>Sen</th>";
		echo "<th>Sel</th>";
		echo "<th>Rab</th>";
		echo "<th>Kam</th>";
		echo "<th>Jum</th>";
		echo "<th>Sab</th>";
		echo "<th>Min</th>";
		echo "</tr>";
		$kolom = 0;
		for ($i = 1; $i <= $jumlah_hari; $i++) {
			if ($kolom == 0) {
				echo "<tr>";
				for ($j = 1; $j < $hari_pertama; $j++) {
					echo "<td></td>";
					$kolom++;
				}
			}
			$tanggal = "$tahun-$bulan-$i";
			if (isset($data_jadwal[$tanggal])) {
				$jadwal = $data_jadwal[$tanggal];
			} else {
				$jadwal = "";
			}
			echo "<td>$i<br>$jadwal</td>";
			$kolom++;
			if ($kolom == 7) {
				echo "</tr>";
				if ($i != $jumlah_hari) {
					echo "<tr>";
				}
				$kolom = 0;
			}
		}
		echo "</table>";
		mysqli_close($koneksi);
	?>
	<h2>Tambah Jadwal</h2>
	<form method="post" action="<?php echo $_SERVER['PHP_SELF'];?>">
<p>Tanggal: <input type="date" name="tanggal"></p>
<p>Jadwal: <input type="text" name="jadwal"></p>
<input type="submit" name="submit" value="Tambah">
</form>

</body>
</html>

